(()=>{var e,t,n,r,o,u,a,i,l,c,s,m;i=document.getElementById("url"),u=document.querySelector(".form"),document.querySelector(".btn"),(r=document.getElementById("api")).value=localStorage.getItem("API_KEY"),t=(new Date).toISOString().split("T")[0],n="",e="",u.addEventListener("submit",(function(t){var n;if(t.preventDefault(),localStorage.setItem("API_KEY",r.value.trim()),e=localStorage.getItem("API_KEY"),(n=i.value.trim()).includes("youtube.com"))return u.reset(),o(n);console.error("type a valid yt url")})),o=function(t){return a(t).then((function(t){var n,r,o;return o=null,n=[],(r=function(){var u;return u=`https://www.googleapis.com/youtube/v3/commentThreads?part=snippet,replies&videoId=${t}&key=${e}`,o&&(u+=`&pageToken=${o}`),u+="&maxResults=100",fetch(u).then((function(e){return e.json()})).then((function(e){var t,u;return t=e.items,u=e.nextPageToken,n.push(...t),u?(o=u,r()):l(n)}))})()}))},l=function(e){var t,n,r,o;for(c(e),n=0,r=e.length;n<r;n++)(t=e[n]).snippet.totalReplyCount&&(({replies:o}=t),s(o));return m()},c=function(e){return e.map((function(e){var t,r,o,u;return({authorDisplayName:t,textOriginal:u,likeCount:o}=e.snippet.topLevelComment.snippet),r=u.replace(/\n/g,""),n+=`${t},${r},${o}`,n+="\n"}))},s=function(e){return e.comments.map((function(e){var t,r,o,u;return({authorDisplayName:t,textOriginal:u,likeCount:o}=e.snippet),r=u.replace(/\n/g,""),n+=`${t},${r},${o}`,n+="\n"}))},a=function(e){return new Promise((function(t,n){return t(new URLSearchParams(new URL(e).search).get("v"))}))},m=function(){var e,r,o;return r=`comments-${t}.csv`,e=new Blob([n],{type:"text/csv"}),o=URL.createObjectURL(e),chrome.downloads.download({url:o,filename:r,saveAs:!0})}})();