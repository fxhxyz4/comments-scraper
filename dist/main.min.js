(()=>{var e,t,n,r,o,a,u,l,i,c,m,p,s,d,v;i=document.getElementById("url"),u=document.querySelector(".form"),document.querySelector(".btn"),(r=document.getElementById("api")).value=localStorage.getItem("API_KEY"),t=(new Date).toISOString().split("T")[0],n="",s=/(?:youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,d=/(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/,e="",o={},u.addEventListener("submit",(function(t){var n;if(t.preventDefault(),localStorage.setItem("API_KEY",r.value.trim()),e=localStorage.getItem("API_KEY"),(n=i.value.trim()).includes("youtube.com"))return u.reset(),a(n);console.error("Type a valid yt url")})),a=function(t){return l(t).then((function(t){var n,r,o;return o=null,n=[],(r=function(){var a;return a=`https://www.googleapis.com/youtube/v3/commentThreads?part=snippet,replies&videoId=${t}&key=${e}`,o&&(a+=`&pageToken=${o}`),a+="&maxResults=100",fetch(a).then((function(e){return e.json()})).then((function(e){var t,a;return t=e.items,a=e.nextPageToken,n.push(...t),a?(o=a,r()):c(n)}))})()}))},c=function(e){var t,n,r,o;for(m(e),n=0,r=e.length;n<r;n++)(t=e[n]).snippet.totalReplyCount&&(({replies:o}=t),p(o));return v()},m=function(e){return e.map((function(e){var t,r,a,u,l,i;return({id:a,snippet:l}=e),({authorDisplayName:t,textOriginal:i,likeCount:u}=l.topLevelComment.snippet),r=i.replace(/\n/g,"").replaceAll(",",". "),o[a]={name:t,id:a},n+=`${t},${r},like: ${u}`,n+="\n"}))},p=function(e){return e.comments.map((function(e){var t,r,a,u,l,i;return({authorDisplayName:t,textOriginal:i,likeCount:a,parentId:l}=e.snippet),r=i.replace(/\n/g,"").replaceAll(",",". "),o[l]?(u=o[l].name,l=o[l].id):(u="Undefined",l="Undefined"),n+=`${t},${r},like: ${a},replyTo: ${u},replyId: ${l}`,n+="\n"}))},l=function(e){return new Promise((function(t,n){var r,o;return r=e.match(s),o=e.match(d),r&&r[1]?t(r[1]):o&&o[1]?t(o[1]):n("Unable to extract video ID from URL")}))},v=function(){var e,r,o;return r=`comments-${t}.csv`,e=new Blob([n],{type:"text/csv"}),o=URL.createObjectURL(e),chrome.downloads.download({url:o,filename:r,saveAs:!0})}})();
